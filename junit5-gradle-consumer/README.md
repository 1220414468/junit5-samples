# junit5-gradle-consumer

The `junit5-gradle-consumer` project demonstrates how to run tests based on
JUnit 5 snapshots using Gradle with the help of a very basic JUnit Gradle plugin.

## Enabling the JUnit Gradle Plugin

To use the JUnit Gradle plugin, you first need to configure `build.gradle` as follows.

```groovy
buildscript {
	repositories {
		mavenCentral()
		maven { url 'https://oss.sonatype.org/content/repositories/snapshots' }
	}
	dependencies {
		classpath 'org.junit:junit-gradle:5.0.0-SNAPSHOT'
	}
}

apply plugin: 'org.junit.gen5.gradle'
```

## Configuring the JUnit Gradle Plugin

Once the JUnit Gradle plugin has been applied, you can configure it as follows.

```groovy
junit5 {
	version '5.0.0-SNAPSHOT'
	matchClassName '.*Test'
	engines {
		// include 'junit5'
		// exclude 'junit4'
	}
	tags {
		// include 'fast'
		// exclude 'slow'
	}
	// disableStandardTestTask false
	// reportsDir "build/test-results/junit5" // this is the default
}
```

By default all engines and tags are included in the test plan.

If you supply a _Test Engine ID_ via `engines {include ...}` or `engines {exclude ...}`,
the JUnit Gradle plugin will only run tests for the desired test engines.

If you supply a _tag_ via `tags {include ...}`, the JUnit Gradle plugin will only
run tests that are _tagged_ accordingly (e.g., via the `@Tag` annotation for
JUnit 5 based tests). Similarly, if you supply a _tag_ via `tags {exclude ...}`,
the JUnit Gradle plugin will not run tests that are _tagged_ accordingly.

By default, the JUnit Gradle plugin disables the standard Gradle `test` task, but
this be overridden via the `disableStandardTestTask` flag.

## Configuring Test Engines

In order to have the JUnit Gradle plugin run any tests at all, a TestEngine
implementation must be on the classpath.

To configure support for JUnit 5 based tests, configure a `testCompile` dependency
on the JUnit 5 API and a `testRuntime` dependency on the JUnit 5 TestEngine
implementation similar to the following.

```groovy
dependencies {
	testCompile("org.junit:junit5-api:5.0.0-SNAPSHOT")
	testRuntime("org.junit:junit5-engine:5.0.0-SNAPSHOT")
}
```

The JUnit Gradle plugin can also run JUnit 4 based tests as long as you
configure a `testCompile` dependency on JUnit 4 and a `testRuntime` dependency
on the JUnit 4 TestEngine implementation similar to the following.

```groovy
dependencies {
	testCompile("junit:junit:4.12")
	testRuntime("org.junit:junit4-engine:5.0.0-SNAPSHOT")
}
```

## Executing JUnit 5 Tests

Once the JUnit Gradle plugin has been applied and configured, you have a new
`junit5Test` task at your disposal.

Invoking `gradlew clean junit5Test` (or `gradlew clean check`) from the
command line will execute all tests within the project whose class names
match the pattern `.*Test`. This will result in output similar to the
following:

```
:junit5Test

Test run finished after 50 ms
[         3 tests found     ]
[         2 tests started   ]
[         1 tests skipped   ]
[         0 tests aborted   ]
[         2 tests successful]
[         0 tests failed    ]

BUILD SUCCESSFUL
```

If you comment out the `@Disabled` annotation on `SecondTest#mySecondTest()`, you
will then see the build fail with output similar to the following:

```
:junit5Test

Test failures (1):
  junit5:com.example.project.SecondTest:mySecondTest
    com.example.project.SecondTest#mySecondTest
    => Exception: 2 is not equal to 1 ==> expected:<2> but was:<1>

Test run finished after 50 ms
[         3 tests found     ]
[         3 tests started   ]
[         0 tests skipped   ]
[         0 tests aborted   ]
[         2 tests successful]
[         1 tests failed    ]

:junit5Test FAILED

FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':junit5Test'.
> Process 'command '/Library/Java/JavaVirtualMachines/jdk1.8.0_66.jdk/Contents/Home/bin/java'' finished with non-zero exit value 1
```

**Note**: the _exit value_ corresponds to the number of _tests failed_.

### Current Limitations

- The results of any tests run via the JUnit Gradle plugin will not be included
  in the standard test report generated by Gradle; however, the test results
  can be aggregated. See the `reportsDir` property of the plugin.
