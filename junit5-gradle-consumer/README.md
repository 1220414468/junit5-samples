# junit5-gradle-consumer

The `junit5-gradle-consumer` project demonstrates how to run tests based on
the JUnit 5 prototype using Gradle with the help of a very basic `JUnit5Plugin`.

## Enabling the `JUnit5Plugin`

To use the `JUnit5Plugin`, you first need to configure `build.gradle` as follows.

```
buildscript {
	repositories {
		maven { url 'https://oss.sonatype.org/content/repositories/snapshots' }
	}
	dependencies {
		classpath 'org.junit.prototype:junit-gradle:5.0.0-SNAPSHOT'
	}
}

apply plugin: 'org.junit.gen5.gradle'
```

## Configuring the `JUnit5Plugin`

Once the `JUnit5Plugin` has been applied, you can configure it as follows.

```
junit5 {
	version '5.0.0-SNAPSHOT'
	runJunit4 true
	matchClassName '.*Test'
	// includeTag 'fast'
}

```

Setting `runJunit4` to `true` instructs the `JUnit5Plugin` to run JUnit 4
based tests as well. However, you will still need to configure a
`testCompile` dependency on JUnit 4 in your project similar to the following.

```
dependencies {
	testCompile('junit:junit:4.12')
}
```

If you supply one or more _tags_ to the `includeTag` configuration method,
the `JUnit5Plugin` will only run JUnit 5 based tests that are _tagged_
accordingly via the `@Tag` annotation. For example, the `FirstTest` class
in this project is annotated with `@Tag("fast")`.

## Executing JUnit 5 Tests

Once the `JUnit5Plugin` has been applied and configured, you have a new
`junit5Test` task at your disposal.

Invoking `gradlew clean junit5Test` (or `gradlew clean check`) from the
command line will execute all tests within the project whose class names
match the pattern `.*Test`. This will result in output similar to the
following:

```
:junit5Test

Test run finished after 50 ms
[         3 tests found     ]
[         2 tests started   ]
[         1 tests skipped   ]
[         0 tests aborted   ]
[         2 tests successful]
[         0 tests failed    ]

BUILD SUCCESSFUL
```

If you comment out the `@Disabled` annotation on `SecondTest#mySecondTest()`, you
will then see the build fail with output similar to the following:

```
:junit5Test

Test failures (1):
  junit5:com.example.project.SecondTest:mySecondTest
    com.example.project.SecondTest#mySecondTest
    => Exception: 2 is not equal to 1 ==> expected:<2> but was:<1>

Test run finished after 50 ms
[         3 tests found     ]
[         3 tests started   ]
[         0 tests skipped   ]
[         0 tests aborted   ]
[         2 tests successful]
[         1 tests failed    ]

:junit5Test FAILED

FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':junit5Test'.
> Process 'command '/Library/Java/JavaVirtualMachines/jdk1.8.0_66.jdk/Contents/Home/bin/java'' finished with non-zero exit value 1
```

**Note**: the _exit value_ corresponds to the number of _tests failed_.

### Current Limitations

- Even though the build will fail if a test fails, the results will not
  be included in the test report generated by Gradle.
- With `runJunit4` set to `true`, the `JUnit5Plugin` takes over the
  responsibility of running JUnit 4 tests, and the `check` Gradle task
  will no longer depend on the Gradle `test` task. Consequently, the
  results for JUnit 4 tests will not be included in the test report
  generated by Gradle.
